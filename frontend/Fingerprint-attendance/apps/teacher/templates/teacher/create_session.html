<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Session - Teacher Dashboard</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f5f7fa;
        color: #333;
      }

      /* Header */
      .header {
        background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);
        color: white;
        padding: 20px 40px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .header h1 {
        font-size: 1.8em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .back-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        text-decoration: none;
        transition: background 0.3s;
      }

      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Main Content */
      .container {
        max-width: 800px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .form-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 3px 20px rgba(0, 0, 0, 0.1);
        padding: 40px;
      }

      .form-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .form-header h2 {
        color: #2196f3;
        margin-bottom: 10px;
        font-size: 1.8em;
      }

      .form-header p {
        color: #666;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 25px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }

      .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 16px;
        transition: border 0.3s;
      }

      .form-control:focus {
        outline: none;
        border-color: #2196f3;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      /* QR Preview */
      .qr-preview {
        text-align: center;
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 2px dashed #e0e0e0;
      }

      .qr-placeholder {
        width: 200px;
        height: 200px;
        background: white;
        margin: 0 auto 20px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #2196f3;
        font-size: 48px;
        border: 2px solid #e0e0e0;
      }

      /* Form Actions */
      .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
      }

      .btn {
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        text-align: center;
      }

      .btn-primary {
        background: #2196f3;
        color: white;
        flex: 1;
      }

      .btn-primary:hover {
        background: #1976d2;
      }

      .btn-secondary {
        background: #f8f9fa;
        color: #333;
        border: 2px solid #e0e0e0;
      }

      .btn-secondary:hover {
        background: #e9ecef;
      }

      /* Course Selection */
      .course-options {
        display: grid;
        gap: 10px;
      }

      .course-option {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .course-option:hover {
        border-color: #2196f3;
        background: #f8f9fa;
      }

      .course-option.selected {
        border-color: #2196f3;
        background: #e3f2fd;
      }

      .course-code {
        font-weight: bold;
        color: #2196f3;
      }

      .course-name {
        color: #666;
      }

      /* Duration Selector */
      .duration-selector {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .duration-btn {
        width: 40px;
        height: 40px;
        border: 2px solid #e0e0e0;
        background: white;
        border-radius: 6px;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .duration-btn:hover {
        border-color: #2196f3;
      }

      .duration-display {
        min-width: 60px;
        text-align: center;
        font-weight: bold;
        font-size: 18px;
      }

      /* Instructions */
      .instructions {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 15px;
        border-radius: 6px;
        margin: 30px 0;
      }

      .instructions h4 {
        color: #856404;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .instructions ul {
        padding-left: 20px;
        color: #856404;
      }

      .instructions li {
        margin-bottom: 5px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 0 15px;
        }

        .form-card {
          padding: 25px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <h1>üìÖ Create Attendance Session</h1>
        <a href="{% url 'teacher:teacher_dashboard' %}" class="back-btn"
          >‚Üê Back to Dashboard</a
        >
      </div>
    </header>

    <!-- Main Content -->
    <div class="container">
      <div class="form-card">
        <div class="form-header">
          <h2>Create New Attendance Session</h2>
          <p>Setup a new fingerprint attendance session for your class</p>
        </div>

        {% if messages %}
        <div style="margin-bottom: 25px">
          {% for message in messages %}
          <div style="margin-bottom: 25px">
            {% for message in messages %}
            <div
              class="alert {% if 'success' in message.tags %}alert-success {% elif 'error' in message.tags %}alert-error {% else %}alert-info {% endif %}"
            >
              {{ message }}
            </div>
            {% endfor %}
          </div>

          {% endfor %}
        </div>
        {% endif %}

        <form method="POST" action="{% url 'teacher:create_session' %}">
          {% csrf_token %}

          <!-- Session Name -->
          <div class="form-group">
            <label for="session_name">Session Name *</label>
            <input
              type="text"
              id="session_name"
              name="session_name"
              class="form-control"
              placeholder="e.g., CS101 - Lecture 5"
              required
            />
            <small style="color: #666; margin-top: 5px; display: block">
              Give your session a descriptive name (e.g., "CS101 - Database
              Systems")
            </small>
          </div>

          <!-- Course Selection -->
          <div class="form-group">
            <label>Select Course *</label>
            <div class="course-options">
              {% for course in courses %}
              <label
                class="course-option {% if forloop.first %}selected{% endif %}"
              >
                <input
                  type="radio"
                  name="course_id"
                  value="{{ course.id }}"
                  {%
                  if
                  forloop.first
                  %}checked{%
                  endif
                  %}
                  style="display: none"
                />
                <div style="font-size: 1.5em">üìö</div>
                <div>
                  <div class="course-code">{{ course.code }}</div>
                  <div class="course-name">{{ course.name }}</div>
                  <small style="color: #666"
                    >{{ course.student_count }} students enrolled</small
                  >
                </div>
              </label>
              {% empty %}
              <div
                style="
                  text-align: center;
                  padding: 20px;
                  color: #666;
                  background: #f8f9fa;
                  border-radius: 6px;
                "
              >
                No courses available. Please contact administrator.
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Session Details Row -->
          <div class="form-row">
            <!-- Duration -->
            <div class="form-group">
              <label>Session Duration (minutes)</label>
              <div class="duration-selector">
                <button
                  type="button"
                  class="duration-btn"
                  onclick="changeDuration(-15)"
                >
                  -
                </button>
                <div class="duration-display" id="duration">60</div>
                <button
                  type="button"
                  class="duration-btn"
                  onclick="changeDuration(15)"
                >
                  +
                </button>
              </div>
              <input
                type="hidden"
                name="duration"
                id="durationInput"
                value="60"
              />
              <small style="color: #666; margin-top: 5px; display: block">
                How long the session will remain active
              </small>
            </div>

            <!-- Auto-end -->
            <div class="form-group">
              <label>Auto-end Session</label>
              <select name="auto_end" class="form-control">
                <option value="yes">Yes, end automatically</option>
                <option value="no">No, end manually</option>
              </select>
              <small style="color: #666; margin-top: 5px; display: block">
                Automatically end session after duration
              </small>
            </div>
          </div>

          <!-- Instructions -->
          <div class="instructions">
            <h4>üìã How it works:</h4>
            <ul>
              <li>
                Students will scan their fingerprints at the attendance station
              </li>
              <li>Attendance is recorded in real-time</li>
              <li>You can monitor attendance as it happens</li>
              <li>Session will generate a unique QR code for mobile access</li>
            </ul>
          </div>

          <!-- QR Preview -->
          <div class="qr-preview">
            <div class="qr-placeholder">üì±</div>
            <p><strong>QR Code Preview</strong></p>
            <p style="color: #666; font-size: 0.9em">
              Students can also scan this QR code with their phones
            </p>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">
              üöÄ Create Session & Generate QR Code
            </button>
            <a
              href="{% url 'teacher:teacher_dashboard' %}"
              class="btn btn-secondary"
            >
              Cancel
            </a>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Duration controls
      function changeDuration(change) {
        const durationDisplay = document.getElementById("duration");
        const durationInput = document.getElementById("durationInput");
        let currentDuration = parseInt(durationDisplay.textContent);

        let newDuration = currentDuration + change;
        if (newDuration < 15) newDuration = 15;
        if (newDuration > 180) newDuration = 180;

        durationDisplay.textContent = newDuration;
        durationInput.value = newDuration;
      }

      // Course selection
      document.querySelectorAll(".course-option").forEach((option) => {
        option.addEventListener("click", function () {
          // Remove selected class from all options
          document.querySelectorAll(".course-option").forEach((opt) => {
            opt.classList.remove("selected");
          });

          // Add selected class to clicked option
          this.classList.add("selected");

          // Check the radio button inside
          const radio = this.querySelector('input[type="radio"]');
          if (radio) radio.checked = true;
        });
      });

      // Form validation
      document.querySelector("form").addEventListener("submit", function (e) {
        const sessionName = document.getElementById("session_name").value;
        if (!sessionName.trim()) {
          e.preventDefault();
          alert("Please enter a session name");
          document.getElementById("session_name").focus();
          return false;
        }

        // Show loading
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = "‚è≥ Creating Session...";
        submitBtn.disabled = true;

        return true;
      });
    </script>
  </body>
</html>
